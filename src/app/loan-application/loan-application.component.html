<div class="loan-application-container">
  <div class="page-header">
    <h1>Loan Application</h1>
    @if (selectedOfficer) {
      <p class="subtitle">
        You're applying with <span class="officer-name">{{selectedOfficer.name}}</span>
      </p>
    } @else {
      <p class="subtitle">Complete the form below to start your mortgage application</p>
    }
  </div>
  
  <!-- Application Success Message -->
  @if (applicationSubmitted) {
    <div class="success-message">
      <div class="success-icon">‚úì</div>
      <h2>Application Submitted Successfully!</h2>
      <p>Thank you for your application. {{ selectedOfficer ? selectedOfficer.name : 'One of our loan officers' }} will contact you shortly to discuss the next steps.</p>
      <button class="btn-home" (click)="navigateToHome()">Return to Home Page</button>
    </div>
  }
  
  <!-- Loan Purpose Selection - Only show if not submitted and purpose not selected -->
  @if (!applicationSubmitted && !loanPurposeSelected) {
    <div class="application-form loan-purpose-form">
      <div class="form-section">
        <h2>What type of mortgage are you interested in?</h2>
        <p>This will help us tailor the application to your specific needs</p>
        
        <form [formGroup]="loanPurposeForm">
          <div class="loan-purpose-options">
            <div class="purpose-option">
              <label class="radio-card">
                <input type="radio" formControlName="purpose" value="purchase">
                <div class="card-content">
                  <div class="icon">üè†</div>
                  <h3>New Purchase</h3>
                  <p>I want to buy a new home</p>
                </div>
              </label>
            </div>
            
            <div class="purpose-option">
              <label class="radio-card">
                <input type="radio" formControlName="purpose" value="refinance">
                <div class="card-content">
                  <div class="icon">üí∞</div>
                  <h3>Refinance</h3>
                  <p>I want to refinance my current mortgage</p>
                </div>
              </label>
            </div>
          </div>
          
          @if (hasError(loanPurposeForm, 'purpose', 'required') && loanPurposeForm.get('purpose')?.touched) {
            <div class="error-message purpose-error">
              Please select an option to continue
            </div>
          }
          
          <div class="form-navigation purpose-navigation">
            <button 
              class="btn-next" 
              [disabled]="!loanPurposeForm.valid"
              (click)="selectLoanPurpose()">
              Continue
            </button>
          </div>
        </form>
      </div>
    </div>
  }
  
  <!-- Application Form - Only show if not submitted and purpose is selected -->
  @if (!applicationSubmitted && loanPurposeSelected) {
    <div class="application-form">
      <!-- Selected Officer Info -->
      @if (selectedOfficer) {
        <div class="selected-officer">
          <div class="info-box">
            <div class="officer-image">
              <img [src]="selectedOfficer.imageUrl" [alt]="selectedOfficer.name" onerror="this.src='assets/loan-officers/placeholder-profile.png'">
            </div>
            <div class="officer-details">
              <h3>Your selected loan officer:</h3>
              <p class="officer-name">{{selectedOfficer.name}}</p>
              <p class="officer-note">Your application will be handled personally by this loan officer.</p>
            </div>
          </div>
        </div>
      }
      
      <!-- Loan Purpose Indicator -->
      <div class="loan-purpose-indicator">
        <div class="loan-type-pill">
          <span class="loan-type-icon">{{ isRefinance ? 'üí∞' : 'üè†' }}</span>
          <span>{{ isRefinance ? 'Refinance' : 'New Purchase' }}</span>
        </div>
        <button class="change-btn" (click)="resetLoanPurpose()">Change</button>
      </div>
      
      <!-- Progress Steps -->
      <div class="progress-steps">
        @for (step of [1, 2, 3, 4, 5]; track step) {
          <div class="step-indicator" 
               [class.active]="currentStep === step"
               [class.completed]="currentStep > step">
            <div class="step-number">
              @if (currentStep <= step) {
                <span>{{step}}</span>
              } @else {
                <span>‚úì</span>
              }
            </div>
            <div class="step-label">{{getStepTitle(step)}}</div>
          </div>
        }
      </div>
      
      <!-- Step 1: Personal Information -->
      @if (currentStep === 1) {
        <form [formGroup]="personalInfoForm">
          <div class="form-section">
            <h2>Personal Information</h2>
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name <span class="required">*</span></label>
                <input type="text" id="firstName" formControlName="firstName">
                @if (hasError(personalInfoForm, 'firstName', 'required')) {
                  <div class="error-message">
                    First name is required
                  </div>
                }
              </div>
              <div class="form-group">
                <label for="lastName">Last Name <span class="required">*</span></label>
                <input type="text" id="lastName" formControlName="lastName">
                @if (hasError(personalInfoForm, 'lastName', 'required')) {
                  <div class="error-message">
                    Last name is required
                  </div>
                }
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="email">Email Address <span class="required">*</span></label>
                <input type="email" id="email" formControlName="email">
                @if (hasError(personalInfoForm, 'email', 'required')) {
                  <div class="error-message">
                    Email is required
                  </div>
                }
                @if (hasError(personalInfoForm, 'email', 'email')) {
                  <div class="error-message">
                    Please enter a valid email address
                  </div>
                }
              </div>
              <div class="form-group">
                <label for="phone">Phone Number <span class="required">*</span></label>
                <input type="tel" id="phone" formControlName="phone">
                @if (hasError(personalInfoForm, 'phone', 'required')) {
                  <div class="error-message">
                    Phone number is required
                  </div>
                }
              </div>
            </div>
            
            <div class="form-group">
              <label for="address">Street Address <span class="required">*</span></label>
              <input type="text" id="address" formControlName="address">
              @if (hasError(personalInfoForm, 'address', 'required')) {
                <div class="error-message">
                  Address is required
                </div>
              }
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="city">City <span class="required">*</span></label>
                <input type="text" id="city" formControlName="city">
                @if (hasError(personalInfoForm, 'city', 'required')) {
                  <div class="error-message">
                    City is required
                  </div>
                }
              </div>
              <div class="form-group">
                <label for="state">State <span class="required">*</span></label>
                <input type="text" id="state" formControlName="state">
                @if (hasError(personalInfoForm, 'state', 'required')) {
                  <div class="error-message">
                    State is required
                  </div>
                }
              </div>
              <div class="form-group">
                <label for="zipCode">ZIP Code <span class="required">*</span></label>
                <input type="text" id="zipCode" formControlName="zipCode">
                @if (hasError(personalInfoForm, 'zipCode', 'required')) {
                  <div class="error-message">
                    ZIP code is required
                  </div>
                }
                @if (hasError(personalInfoForm, 'zipCode', 'pattern')) {
                  <div class="error-message">
                    Please enter a valid ZIP code
                  </div>
                }
              </div>
            </div>
          </div>
        </form>
      }
      
      <!-- Step 2: Property Information -->
      @if (currentStep === 2) {
        <form [formGroup]="propertyInfoForm">
          <div class="form-section">
            <h2>{{ isRefinance ? 'Property & Refinance Details' : 'Property Details' }}</h2>
            
            <!-- Common fields for both new purchase and refinance -->
            <div class="form-group">
              <label for="propertyType">Property Type <span class="required">*</span></label>
              <select id="propertyType" formControlName="propertyType">
                <option value="">Select Property Type</option>
                @for (type of propertyTypes; track type.value) {
                  <option [value]="type.value">{{type.label}}</option>
                }
              </select>
              @if (hasError(propertyInfoForm, 'propertyType', 'required')) {
                <div class="error-message">
                  Property type is required
                </div>
              }
            </div>
            
            <!-- New Purchase specific fields -->
            @if (!isRefinance) {
              <div class="form-group">
                <label for="propertyAddress">Property Address <span class="required">*</span></label>
                <input type="text" id="propertyAddress" formControlName="propertyAddress">
                @if (hasError(propertyInfoForm, 'propertyAddress', 'required')) {
                  <div class="error-message">
                    Property address is required
                  </div>
                }
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="propertyCity">City <span class="required">*</span></label>
                  <input type="text" id="propertyCity" formControlName="propertyCity">
                  @if (hasError(propertyInfoForm, 'propertyCity', 'required')) {
                    <div class="error-message">
                      City is required
                    </div>
                  }
                </div>
                <div class="form-group">
                  <label for="propertyState">State <span class="required">*</span></label>
                  <input type="text" id="propertyState" formControlName="propertyState">
                  @if (hasError(propertyInfoForm, 'propertyState', 'required')) {
                    <div class="error-message">
                      State is required
                    </div>
                  }
                </div>
                <div class="form-group">
                  <label for="propertyZipCode">ZIP Code <span class="required">*</span></label>
                  <input type="text" id="propertyZipCode" formControlName="propertyZipCode">
                  @if (hasError(propertyInfoForm, 'propertyZipCode', 'required')) {
                    <div class="error-message">
                      ZIP code is required
                    </div>
                  }
                  @if (hasError(propertyInfoForm, 'propertyZipCode', 'pattern')) {
                    <div class="error-message">
                      Please enter a valid ZIP code
                    </div>
                  }
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="purchasePrice">Purchase Price ($) <span class="required">*</span></label>
                  <input type="text" id="purchasePrice" formControlName="purchasePrice">
                  @if (hasError(propertyInfoForm, 'purchasePrice', 'required')) {
                    <div class="error-message">
                      Purchase price is required
                    </div>
                  }
                  @if (hasError(propertyInfoForm, 'purchasePrice', 'pattern')) {
                    <div class="error-message">
                      Please enter a valid amount
                    </div>
                  }
                </div>
                <div class="form-group">
                  <label for="downPayment">Down Payment ($) <span class="required">*</span></label>
                  <input type="text" id="downPayment" formControlName="downPayment">
                  @if (hasError(propertyInfoForm, 'downPayment', 'required')) {
                    <div class="error-message">
                      Down payment is required
                    </div>
                  }
                  @if (hasError(propertyInfoForm, 'downPayment', 'pattern')) {
                    <div class="error-message">
                      Please enter a valid amount
                    </div>
                  }
                </div>
              </div>
            }
            
            <!-- Refinance specific fields -->
            @if (isRefinance) {
              <div class="form-row">
                <div class="form-group">
                  <label for="currentValue">Current Property Value ($) <span class="required">*</span></label>
                  <input type="text" id="currentValue" formControlName="currentValue">
                  @if (hasError(propertyInfoForm, 'currentValue', 'required')) {
                    <div class="error-message">
                      Property value is required
                    </div>
                  }
                  @if (hasError(propertyInfoForm, 'currentValue', 'pattern')) {
                    <div class="error-message">
                      Please enter a valid amount
                    </div>
                  }
                </div>
                <div class="form-group">
                  <label for="currentLoanBalance">Current Loan Balance ($) <span class="required">*</span></label>
                  <input type="text" id="currentLoanBalance" formControlName="currentLoanBalance">
                  @if (hasError(propertyInfoForm, 'currentLoanBalance', 'required')) {
                    <div class="error-message">
                      Current loan balance is required
                    </div>
                  }
                  @if (hasError(propertyInfoForm, 'currentLoanBalance', 'pattern')) {
                    <div class="error-message">
                      Please enter a valid amount
                    </div>
                  }
                </div>
              </div>
              
              <div class="form-group">
                <label for="refinanceReason">Primary Reason for Refinancing <span class="required">*</span></label>
                <select id="refinanceReason" formControlName="refinanceReason">
                  <option value="">Select Reason</option>
                  @for (reason of getRefinanceReasons(); track reason.value) {
                    <option [value]="reason.value">{{reason.label}}</option>
                  }
                </select>
                @if (hasError(propertyInfoForm, 'refinanceReason', 'required')) {
                  <div class="error-message">
                    Refinance reason is required
                  </div>
                }
              </div>
              
              <!-- For refinance, we still need purchase price and down payment fields with different labels -->
              <div class="form-row">
                <div class="form-group">
                  <label for="purchasePrice">Cash Out Amount ($) <span class="required">*</span></label>
                  <input type="text" id="purchasePrice" formControlName="purchasePrice">
                  @if (hasError(propertyInfoForm, 'purchasePrice', 'required')) {
                    <div class="error-message">
                      Cash out amount is required
                    </div>
                  }
                  @if (hasError(propertyInfoForm, 'purchasePrice', 'pattern')) {
                    <div class="error-message">
                      Please enter a valid amount
                    </div>
                  }
                </div>
                <div class="form-group">
                  <label for="downPayment">Years Remaining on Current Loan <span class="required">*</span></label>
                  <input type="text" id="downPayment" formControlName="downPayment">
                  @if (hasError(propertyInfoForm, 'downPayment', 'required')) {
                    <div class="error-message">
                      This field is required
                    </div>
                  }
                  @if (hasError(propertyInfoForm, 'downPayment', 'pattern')) {
                    <div class="error-message">
                      Please enter a valid number
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        </form>
      }
      
      <!-- Step 3: Financial Information -->
      @if (currentStep === 3) {
        <form [formGroup]="financialInfoForm">
          <div class="form-section">
            <h2>Financial Information</h2>
            
            <div class="form-row">
              <div class="form-group">
                <label for="annualIncome">Annual Income ($) <span class="required">*</span></label>
                <input type="text" id="annualIncome" formControlName="annualIncome">
                @if (hasError(financialInfoForm, 'annualIncome', 'required')) {
                  <div class="error-message">
                    Annual income is required
                  </div>
                }
                @if (hasError(financialInfoForm, 'annualIncome', 'pattern')) {
                  <div class="error-message">
                    Please enter a valid amount
                  </div>
                }
              </div>
              <div class="form-group">
                <label for="monthlyDebt">Monthly Debt Payments ($) <span class="required">*</span></label>
                <input type="text" id="monthlyDebt" formControlName="monthlyDebt">
                @if (hasError(financialInfoForm, 'monthlyDebt', 'required')) {
                  <div class="error-message">
                    Monthly debt is required
                  </div>
                }
                @if (hasError(financialInfoForm, 'monthlyDebt', 'pattern')) {
                  <div class="error-message">
                    Please enter a valid amount
                  </div>
                }
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="employmentStatus">Employment Status <span class="required">*</span></label>
                <select id="employmentStatus" formControlName="employmentStatus">
                  <option value="">Select Status</option>
                  @for (status of employmentStatuses; track status.value) {
                    <option [value]="status.value">{{status.label}}</option>
                  }
                </select>
                @if (hasError(financialInfoForm, 'employmentStatus', 'required')) {
                  <div class="error-message">
                    Employment status is required
                  </div>
                }
              </div>
              <div class="form-group">
                <label for="employer">Current Employer</label>
                <input type="text" id="employer" formControlName="employer">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="creditScore">Credit Score Range <span class="required">*</span></label>
                <select id="creditScore" formControlName="creditScore">
                  <option value="">Select Range</option>
                  @for (range of getCreditScoreRanges(); track range.value) {
                    <option [value]="range.value">{{range.label}}</option>
                  }
                </select>
                @if (hasError(financialInfoForm, 'creditScore', 'required')) {
                  <div class="error-message">
                    Credit score range is required
                  </div>
                }
              </div>
              <div class="form-group">
                <label for="loanType">Preferred Loan Type <span class="required">*</span></label>
                <select id="loanType" formControlName="loanType">
                  <option value="">Select Loan Type</option>
                  @for (loan of loanTypes; track loan.value) {
                    <option [value]="loan.value">{{loan.label}}</option>
                  }
                </select>
                @if (hasError(financialInfoForm, 'loanType', 'required')) {
                  <div class="error-message">
                    Loan type is required
                  </div>
                }
              </div>
            </div>
          </div>
        </form>
      }
      
      <!-- Step 4: Living History -->
      @if (currentStep === 4) {
        <form [formGroup]="livingHistoryForm">
          <div class="form-section">
            <h2>Living History</h2>
            <p class="section-subtitle">
              Please provide your residence history for the past two years. This information is required for mortgage underwriting.
            </p>
            
            <div class="history-section">
              <h3>Current Residence</h3>
              
              <div class="form-group">
                <label for="currentResidenceType">Current Housing Situation <span class="required">*</span></label>
                <select id="currentResidenceType" formControlName="currentResidenceType" (change)="updatePreviousResidenceValidators()">
                  <option value="">Select Housing Status</option>
                  @for (type of getResidenceTypes(); track type.value) {
                    <option [value]="type.value">{{type.label}}</option>
                  }
                </select>
                @if (hasError(livingHistoryForm, 'currentResidenceType', 'required')) {
                  <div class="error-message">
                    Current housing situation is required
                  </div>
                }
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="currentResidenceYears">Years at Current Address <span class="required">*</span></label>
                  <input type="number" min="0" max="99" id="currentResidenceYears" formControlName="currentResidenceYears" (change)="updatePreviousResidenceValidators()">
                  @if (hasError(livingHistoryForm, 'currentResidenceYears', 'required')) {
                    <div class="error-message">
                      Years is required
                    </div>
                  }
                  @if (hasError(livingHistoryForm, 'currentResidenceYears', 'pattern')) {
                    <div class="error-message">
                      Please enter a valid number
                    </div>
                  }
                </div>
                <div class="form-group">
                  <label for="currentResidenceMonths">Months <span class="required">*</span></label>
                  <input type="number" min="0" max="11" id="currentResidenceMonths" formControlName="currentResidenceMonths" (change)="updatePreviousResidenceValidators()">
                  @if (hasError(livingHistoryForm, 'currentResidenceMonths', 'required')) {
                    <div class="error-message">
                      Months is required
                    </div>
                  }
                  @if (hasError(livingHistoryForm, 'currentResidenceMonths', 'pattern')) {
                    <div class="error-message">
                      Please enter a valid number
                    </div>
                  }
                </div>
                <div class="form-group">
                  <label for="currentMonthlyPayment">Monthly Payment/Rent ($) <span class="required">*</span></label>
                  <input type="text" id="currentMonthlyPayment" formControlName="currentMonthlyPayment">
                  @if (hasError(livingHistoryForm, 'currentMonthlyPayment', 'required')) {
                    <div class="error-message">
                      Monthly payment is required
                    </div>
                  }
                  @if (hasError(livingHistoryForm, 'currentMonthlyPayment', 'pattern')) {
                    <div class="error-message">
                      Please enter a valid amount
                    </div>
                  }
                </div>
              </div>
            </div>
            
            <!-- Previous Residences section - only show if current residence is less than 2 years -->
            @if (getTotalMonthsAtCurrentResidence() && getTotalMonthsAtCurrentResidence() < 24) {
              <div class="history-section previous-residences">
                <h3>Previous Residences</h3>
                <p class="requirement-note">
                  Since you've been at your current address for less than 2 years, we need your previous address information to cover a full 2-year history.
                  <strong>Current residence duration: {{ getTotalMonthsAtCurrentResidence() }} months</strong>
                </p>
                
                <div class="residence-history-status" [class.complete]="hasEnoughResidenceHistory()">
                  <div class="status-icon">{{ hasEnoughResidenceHistory() ? '‚úì' : '!' }}</div>
                  <div class="status-message">
                    @if (hasEnoughResidenceHistory()) {
                      <span>Your residence history covers the required 2-year period ({{ getTotalResidenceHistoryMonths() }} months).</span>
                    } @else {
                      <span>You need to provide {{ 24 - getTotalResidenceHistoryMonths() }} more months of residence history.</span>
                    }
                  </div>
                </div>
                
                <!-- Iterate through previous residences -->
                <div formArrayName="previousResidences">
                  @for (residence of previousResidences.controls; track $index) {
                    <div class="previous-residence-item" [formGroupName]="$index">
                      <div class="residence-header">
                        <h4>Previous Address {{ $index + 1 }}</h4>
                        @if (previousResidences.length > 1) {
                          <button type="button" class="btn-remove" (click)="removePreviousResidence($index)">
                            <span>√ó</span> Remove
                          </button>
                        }
                      </div>
                      
                      <div class="form-group">
                        <label [for]="'address-' + $index">Street Address <span class="required">*</span></label>
                        <input type="text" [id]="'address-' + $index" formControlName="address">
                        @if (residence.get('address')?.invalid && (residence.get('address')?.dirty || residence.get('address')?.touched)) {
                          <div class="error-message">
                            Address is required
                          </div>
                        }
                      </div>
                      
                      <div class="form-row">
                        <div class="form-group">
                          <label [for]="'city-' + $index">City <span class="required">*</span></label>
                          <input type="text" [id]="'city-' + $index" formControlName="city">
                          @if (residence.get('city')?.invalid && (residence.get('city')?.dirty || residence.get('city')?.touched)) {
                            <div class="error-message">
                              City is required
                            </div>
                          }
                        </div>
                        <div class="form-group">
                          <label [for]="'state-' + $index">State <span class="required">*</span></label>
                          <input type="text" [id]="'state-' + $index" formControlName="state">
                          @if (residence.get('state')?.invalid && (residence.get('state')?.dirty || residence.get('state')?.touched)) {
                            <div class="error-message">
                              State is required
                            </div>
                          }
                        </div>
                        <div class="form-group">
                          <label [for]="'zipCode-' + $index">ZIP Code <span class="required">*</span></label>
                          <input type="text" [id]="'zipCode-' + $index" formControlName="zipCode">
                          @if (residence.get('zipCode')?.errors?.['required'] && (residence.get('zipCode')?.dirty || residence.get('zipCode')?.touched)) {
                            <div class="error-message">
                              ZIP code is required
                            </div>
                          }
                          @if (residence.get('zipCode')?.errors?.['pattern'] && (residence.get('zipCode')?.dirty || residence.get('zipCode')?.touched)) {
                            <div class="error-message">
                              Please enter a valid ZIP code
                            </div>
                          }
                        </div>
                      </div>
                      
                      <div class="form-group">
                        <label [for]="'residenceType-' + $index">Housing Situation <span class="required">*</span></label>
                        <select [id]="'residenceType-' + $index" formControlName="residenceType">
                          <option value="">Select Housing Status</option>
                          @for (type of getResidenceTypes(); track type.value) {
                            <option [value]="type.value">{{type.label}}</option>
                          }
                        </select>
                        @if (residence.get('residenceType')?.invalid && (residence.get('residenceType')?.dirty || residence.get('residenceType')?.touched)) {
                          <div class="error-message">
                            Housing situation is required
                          </div>
                        }
                      </div>
                      
                      <div class="form-row">
                        <div class="form-group">
                          <label [for]="'years-' + $index">Years at This Address <span class="required">*</span></label>
                          <input type="number" min="0" max="99" [id]="'years-' + $index" formControlName="years">
                          @if (residence.get('years')?.invalid && (residence.get('years')?.dirty || residence.get('years')?.touched)) {
                            <div class="error-message">
                              Years is required
                            </div>
                          }
                        </div>
                        <div class="form-group">
                          <label [for]="'months-' + $index">Months <span class="required">*</span></label>
                          <input type="number" min="0" max="11" [id]="'months-' + $index" formControlName="months">
                          @if (residence.get('months')?.invalid && (residence.get('months')?.dirty || residence.get('months')?.touched)) {
                            <div class="error-message">
                              Months is required
                            </div>
                          }
                        </div>
                        <div class="form-group">
                          <label [for]="'monthlyPayment-' + $index">Monthly Payment/Rent ($) <span class="required">*</span></label>
                          <input type="text" [id]="'monthlyPayment-' + $index" formControlName="monthlyPayment">
                          @if (residence.get('monthlyPayment')?.invalid && (residence.get('monthlyPayment')?.dirty || residence.get('monthlyPayment')?.touched)) {
                            <div class="error-message">
                              Monthly payment is required
                            </div>
                          }
                        </div>
                      </div>
                    </div>
                  }
                </div>
                
                <div class="add-residence-container">
                  <button type="button" class="btn-add-residence" (click)="addPreviousResidence()">
                    + Add Another Previous Residence
                  </button>
                  
                  @if (!hasEnoughResidenceHistory()) {
                    <div class="add-residence-warning">
                      Please add more residence history to cover the full 2-year period.
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        </form>
      }
      
      <!-- Step 5: Documentation & Review -->
      @if (currentStep === 5) {
        <form [formGroup]="documentationForm">
          <div class="form-section">
            <h2>Documentation & Review</h2>
            
            <p class="documentation-note">
              Please confirm that you have the following documents ready for submission. 
              These will be required for your loan application processing.
            </p>
            
            <div class="document-checklist">
              <div class="document-item">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="idUploaded"> 
                  Government-issued ID (driver's license, passport, etc.)
                  <span class="required">*</span>
                </label>
                @if (hasError(documentationForm, 'idUploaded', 'required')) {
                  <div class="error-message">
                    Please confirm you have this document
                  </div>
                }
              </div>
              
              <div class="document-item">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="proofOfIncomeUploaded"> 
                  Proof of Income (2 years of W-2s, last 3 pay stubs)
                  <span class="required">*</span>
                </label>
                @if (hasError(documentationForm, 'proofOfIncomeUploaded', 'required')) {
                  <div class="error-message">
                    Please confirm you have this document
                  </div>
                }
              </div>
              
              <div class="document-item">
                <label class="checkbox-label">
                  <input type="checkbox" formControlName="bankStatementsUploaded"> 
                  Bank Statements (last 2-3 months)
                  <span class="required">*</span>
                </label>
                @if (hasError(documentationForm, 'bankStatementsUploaded', 'required')) {
                  <div class="error-message">
                    Please confirm you have this document
                  </div>
                }
              </div>
            </div>
            
            <div class="terms-agreement">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="agreeToTerms"> 
                I agree to the terms and conditions, and authorize Innovative Mortgage Solutions to check my credit.
                <span class="required">*</span>
              </label>
              @if (hasError(documentationForm, 'agreeToTerms', 'required')) {
                <div class="error-message">
                  You must agree to the terms to continue
                </div>
              }
            </div>
            
            <div class="application-summary">
              <h3>Application Summary</h3>
              <p>Please review your application before submission. You can go back to any step to make changes.</p>
              <div class="summary-details">
                <div class="summary-item">
                  <span class="label">Application Type:</span>
                  <span class="value">{{ isRefinance ? 'Refinance' : 'New Purchase' }}</span>
                </div>
                
                <!-- Add living history information to summary -->
                <div class="summary-item">
                  <span class="label">Current Housing:</span>
                  <span class="value">
                    {{ livingHistoryForm.get('currentResidenceYears')?.value || '0' }} years, 
                    {{ livingHistoryForm.get('currentResidenceMonths')?.value || '0' }} months
                    ({{ livingHistoryForm.get('currentResidenceType')?.value || 'Not specified' }})
                  </span>
                </div>
                
                @if (previousResidences.length > 0) {
                  <div class="summary-item">
                    <span class="label">Previous Residences:</span>
                    <div class="value">
                      @for (residence of previousResidences.controls; track $index) {
                        <div class="previous-residence-summary">
                          <strong>Previous Address {{ $index + 1}}:</strong> 
                          {{ residence.get('years')?.value || '0' }} years, 
                          {{ residence.get('months')?.value || '0' }} months
                          ({{ residence.get('residenceType')?.value || 'Not specified' }})
                        </div>
                      }
                    </div>
                  </div>
                  
                  <div class="summary-item">
                    <span class="label">Total History:</span>
                    <span class="value">
                      {{ getTotalResidenceHistoryMonths() }} months 
                      <span [class.complete-text]="hasEnoughResidenceHistory()" [class.incomplete-text]="!hasEnoughResidenceHistory()">
                        ({{ hasEnoughResidenceHistory() ? 'Complete' : 'Incomplete' }})
                      </span>
                    </span>
                  </div>
                }
              </div>
            </div>
          </div>
        </form>
      }
      
      <!-- Navigation Buttons -->
      <div class="form-navigation">
        @if (currentStep > 1) {
          <button 
            class="btn-previous" 
            (click)="previousStep()">
            Previous
          </button>
        }
        
        @if (currentStep < totalSteps) {
          <button 
            class="btn-next" 
            [disabled]="!isCurrentStepValid()"
            (click)="nextStep()">
            Next
          </button>
        }
        
        @if (currentStep === totalSteps) {
          <button 
            class="btn-submit" 
            [disabled]="!isCurrentStepValid()"
            (click)="submitApplication()">
            Submit Application
          </button>
        }
      </div>
    </div>
  }
</div>